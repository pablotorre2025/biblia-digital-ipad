<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Carga de Biblias</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5; 
        }
        .test-container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer;
            background-color: #007bff;
            color: white;
        }
        button:hover { background-color: #0056b3; }
        #log { 
            background: #f8f9fa; 
            border: 1px solid #ddd; 
            padding: 10px; 
            border-radius: 4px; 
            height: 300px; 
            overflow-y: auto; 
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ðŸ”§ Prueba de Carga de Biblias</h1>
    
    <div class="test-container">
        <h2>Pruebas de Sistema</h2>
        <button onclick="testVersionsFile()">1. Probar versions.json</button>
        <button onclick="testBibleFiles()">2. Probar archivos de Biblia</button>
        <button onclick="testConversion()">3. Probar conversiÃ³n</button>
        <button onclick="clearLog()">Limpiar Log</button>
    </div>

    <div class="test-container">
        <h2>Log de Pruebas</h2>
        <div id="log"></div>
    </div>

    <script src="js/bible-converter.js"></script>
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function testVersionsFile() {
            log('ðŸ§ª Probando carga de versions.json...', 'info');
            
            try {
                const response = await fetch('./data/versions.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log(`âœ… versions.json cargado exitosamente`, 'success');
                log(`ðŸ“Š Total de versiones: ${data.totalVersions}`, 'info');
                
                data.versions.forEach(version => {
                    log(`  ðŸ“– ${version.id}: ${version.name} (${version.filename})`, 'info');
                });
                
            } catch (error) {
                log(`âŒ Error cargando versions.json: ${error.message}`, 'error');
            }
        }

        async function testBibleFiles() {
            log('ðŸ§ª Probando carga de archivos de Biblia...', 'info');
            
            try {
                // Cargar configuraciÃ³n de versiones
                const versionsResponse = await fetch('./data/versions.json');
                if (!versionsResponse.ok) {
                    throw new Error('No se pudo cargar versions.json');
                }
                
                const versionsData = await versionsResponse.json();
                log(`ðŸ“‹ Probando ${versionsData.versions.length} biblias...`, 'info');
                
                for (const version of versionsData.versions) {
                    try {
                        log(`ðŸ” Probando: ${version.name}...`, 'info');
                        
                        const filePath = `./data/biblias-originales/${version.filename}`;
                        const response = await fetch(filePath);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status} para ${version.filename}`);
                        }
                        
                        const data = await response.json();
                        
                        if (!data.books || !Array.isArray(data.books)) {
                            throw new Error(`Formato invÃ¡lido en ${version.filename}`);
                        }
                        
                        log(`  âœ… ${version.name}: ${data.books.length} libros encontrados`, 'success');
                        
                    } catch (error) {
                        log(`  âŒ ${version.name}: ${error.message}`, 'error');
                    }
                }
                
                log('ðŸ Prueba de archivos completada', 'info');
                
            } catch (error) {
                log(`âŒ Error en prueba de archivos: ${error.message}`, 'error');
            }
        }

        async function testConversion() {
            log('ðŸ§ª Probando conversiÃ³n de formato...', 'info');
            
            try {
                // Probar con RV1960
                const response = await fetch('./data/biblias-originales/RV1960.json');
                if (!response.ok) {
                    throw new Error(`No se pudo cargar RV1960.json`);
                }
                
                const originalData = await response.json();
                log(`ðŸ“– Datos originales cargados: ${originalData.books.length} libros`, 'info');
                
                // Convertir usando el convertidor
                if (window.BibleConverter) {
                    const converted = BibleConverter.convertToAppFormat(originalData);
                    const bookNames = Object.keys(converted);
                    
                    log(`âœ… ConversiÃ³n exitosa: ${bookNames.length} libros convertidos`, 'success');
                    log(`ðŸ“š Primeros 5 libros: ${bookNames.slice(0, 5).join(', ')}`, 'info');
                    
                    // Verificar un capÃ­tulo especÃ­fico
                    if (converted['GÃ©nesis'] && converted['GÃ©nesis']['1']) {
                        const verses = Object.keys(converted['GÃ©nesis']['1']).length;
                        log(`ðŸ“œ GÃ©nesis 1: ${verses} versÃ­culos encontrados`, 'success');
                        log(`ðŸ“ GÃ©nesis 1:1: "${converted['GÃ©nesis']['1']['1']}"`, 'info');
                    }
                    
                } else {
                    log(`âŒ BibleConverter no estÃ¡ disponible`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Error en prueba de conversiÃ³n: ${error.message}`, 'error');
            }
        }

        // Auto-ejecutar prueba inicial
        window.addEventListener('load', () => {
            log('ðŸš€ Sistema de pruebas iniciado', 'info');
            log('ðŸ‘† Haz clic en los botones arriba para ejecutar las pruebas', 'info');
        });
    </script>
</body>
</html>